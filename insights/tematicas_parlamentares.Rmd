---
title: "Análise das Ementas da Câmara Municipal de Campina Grande"
date: "19 de Agosto, 2016"
output: html_document
---

<style>
  .col2 {
    columns: 2 450px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 425px; /* chrome, safari */
    -moz-columns: 2 450px;    /* firefox */
  }
</style>

```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 13)

library(dplyr)
library(magrittr)
library(RPostgreSQL)
library(ggplot2)
library(wordcloud)
library(RColorBrewer)

theme_set(theme_bw(16))

camara_db <- src_postgres(dbname = "camara_db", user = "augusto", password = "postgres")

ementas_raw <- tbl(camara_db, sql("SELECT * FROM ementas")) %>% 
  filter(published_date >= "2009-01-01")

ementas <- ementas_raw %>%
  select(published_date, main_theme, situation) %>%
  collect() %>% 
  mutate(govern = ifelse(published_date < "2013-01-01", "Anterior (2009 - 2012)", "Atual (2013 - 2016)"))

theme_count <- ementas %>% 
  filter(situation == 'APROVADO') %>% 
  count(main_theme, govern) %>% 
  ungroup() %>% 
  mutate(main_theme = reorder(main_theme, n, order = T)) %>% 
  filter(n > 10)
```

Nosso objetivo com essa análise é chamar a atenção para os principais temas que tem sido discutidos na nossa Câmara Municipal. Faremos isso de várias formas, inicialmente mostramos que o governo atual (2013 - 2016) tramitou e aprovou mais ementas do que o governo anterior (2009 - 2012) mesmo antes de sua conclusão. 

```{r echo=FALSE, fig.height = 6}
ggplot(ementas, aes(x = govern, fill = situation)) + 
  geom_bar(position = 'dodge') + 
  labs(x = "Governo", y = "Nº de Ementas", fill = "Situação")
```

Apesar do maior número não podemos tomar conclusões precipitadas. Estamos analisando dados reais, por isso precisamos adentrar mais a fundo, explorar as minúcias para saber quais foram as prioridades de cada governo e averiguar o real valor de cada ementa. Para tal filtramos apenas as ementas aprovadas e mostramos os contadores por tema específico.

```{r echo=FALSE, fig.height = 13}
gg <- ggplot(theme_count, aes(x = main_theme, y = n, fill = govern)) + 
  geom_bar(stat = 'identity', position = 'dodge') + 
  coord_flip() +
  labs(x = "Temas Principais", y = "Nº de Ementas", fill = "Governo") + 
  theme(legend.position = 'bottom')
print(gg)
```

Para finalizar expomos a "cara" dos governos com as seguintes nuvems de palavras formadas pelos seus temas mais importantes. Removemos o principal tema para ambos os governos, "Serviços Urbanos", com o objetivo de facilitar a comparação dos demais temas.

<div class="col2">
<center>**Governo Anterior (2009 - 2012)**</center>
```{r, echo=FALSE, fig.width = 8, fig.height = 8}
past_govern_theme_count <- theme_count %>% 
  filter(govern == 'Anterior (2009 - 2012)' & main_theme != 'SERVIÇOS URBANOS')

wordcloud(words = past_govern_theme_count$main_theme, freq = past_govern_theme_count$n,
          colors = brewer.pal(8, "YlOrRd")[-c(1:4)], random.order = F)
```

<center>**Governo Atual (2013 - 2016)**</center>
```{r, echo=FALSE, fig.width = 8, fig.height = 8}
current_govern_theme_count <- theme_count %>% 
  filter(govern != 'Anterior (2009 - 2012)' & main_theme != 'SERVIÇOS URBANOS')

wordcloud(words = current_govern_theme_count$main_theme, freq = current_govern_theme_count$n,
          colors = brewer.pal(8, "YlGnBu")[-c(1:4)], random.order = F)
```
</div>

Com as nuvens de palavras capturamos mais rapidamente quais os temas mais importantes para cada governo. Concluimos então que depois de "Serviços Urbanos" os 5 temas que mais tiveram ementas aprovadas na Cãmara de Campina Grande do **governo atual** foram: 

1. Trânsito Urbano
2. Moção
3. Aguas e Esgoto
4. Denominação de Rua
5. Saúde

Enquanto que no **governo anterior** os seguintes temas tiveram maior notoriedade na CMCG: 

1. Moção
2. Congratulações
3. Trânsito Urbano
4. Saúde
5. Segurança Pública

---
