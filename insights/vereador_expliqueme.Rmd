---
title: "Meu Vereador? Explique-me por favor..."
date: "19 de Agosto, 2016"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, fig.width = 14)

library(readr)
library(dplyr)
library(magrittr)
library(RPostgreSQL)
library(ggplot2)
library(lubridate)
library(stringr)
source("0_utils.R")

theme_set(theme_bw(16))

approved_ementas <- GetEmentaRaw() %>%
    select(published_date, published_month, main_theme, situation, proponents, govern) %>%
    mutate(published_year = year(published_date)) %>% 
    filter(situation == 'APROVADO') %>% 
    select(-situation)

ementa_proponents <- approved_ementas$proponents
approved_ementas$proponents <- NULL

ementa_prop_final <- data_frame()
all_proponents <- str_split(ementa_proponents, ",", -1)
for (i in 1:length(all_proponents)) {
  prop_vec <- all_proponents[[i]]
  row <- approved_ementas[i,]
  row <- row[rep(1, length(prop_vec)),]
  row$proponent <- prop_vec
  ementa_prop_final <- ementa_prop_final %>% bind_rows(row)
}

```

Nessa análise buscamos capturar os padrões temporais do trabalho dos vereadores da Câmara Municipal de Campina Grande individualmente (notem que os Prefeitos também estão inclusos pois também podem propor ementas). Visualizando os gráficos no tempo encontramos alguns vereadores que publicam ementas corriqueiramente, mas estranhamente vemos vários que passam anos sem propor ementa alguma? Qual a razão dessa disparidade? 

```{r proponent_over_time, fig.height=50}

ggplot(ementa_prop_final %>% filter(govern != "Atual (2013 - 2016)"), 
                     aes(x = published_month, fill = proponent)) +
  geom_bar() +
  facet_grid(proponent~published_year, scales = "free_x") +
  scale_x_datetime(date_labels = "%m/%y", date_breaks = "3 months") +
  labs(x = "Data", y = "Nº de Ementas", fill = "Proponente") + 
  ggtitle("Governo Anterior (2009 - 2012)") +
  theme(legend.position = "none", strip.text.y = element_text(angle = 0))

ggplot(ementa_prop_final %>% filter(govern == "Atual (2013 - 2016)"), 
                     aes(x = published_month, fill = proponent)) +
  geom_bar() +
  facet_grid(proponent~published_year, scales = "free_x") +
  scale_x_datetime(date_labels = "%m/%y", date_breaks = "3 months") +
  labs(x = "Data", y = "Nº de Ementas", fill = "Proponente") + 
  ggtitle("Governo Atual (2013 - 2016)") +
  theme(legend.position = "none", strip.text.y = element_text(angle = 0))
```

---
